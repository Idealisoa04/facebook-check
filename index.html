<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion avec Facebook</title>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
</head>
<body>
    <h1>Se connecter avec Facebook</h1>
    <button id="loginBtn">Se connecter</button>

    <script>
        // Initialisation du SDK Facebook
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '1882208185942048', // Remplacez par votre App ID
                cookie     : true,
                xfbml      : true,
                version    : 'v16.0'
            });
        };

        document.getElementById('loginBtn').onclick = function() {
            FB.login(function(response) {
                if (response.authResponse) {
                    // Récupérer les informations utilisateur
                    FB.api('/me', function(userInfo) {
                        const name = userInfo.name; // Nom de l'utilisateur
                        const timestamp = new Date().toISOString(); // Date actuelle

                        // URL de l'application Apps Script
                        const scriptURL = "https://script.google.com/macros/s/AKfycbxuwCE4S6G3T_KjO_1WmnLzt_zsgp4OmyYCvRjd1udWsusZHQnIiayFha2V4n8ug6on/exec";
                        fetch(scriptURL, {
                            method: "POST",
                            mode: "no-cors", // Désactive les vérifications CORS
                            body: JSON.stringify({ name: name, timestamp: timestamp }),
                            headers: {
                                "Content-Type": "application/json"
                            }
                        }).then(() => {
                            alert(name);
                            window.location.href = "https://ngl.link/idealiiisoa19631"; // Rediriger après l'envoi
                        }).catch(err => console.error("Erreur:", err));
                    });
                } else {
                    alert("Connexion annulée.");
                }
            }, { scope: 'public_profile' });
        };
    </script>
</body>
</html>
